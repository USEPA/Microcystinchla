---
title: Associations between Chlorophyll *a* and various Microcystin-LR Health Advisory
  Concentrations
author:
- affilnum: 1
  email: hollister.jeff@epa.gov
  name: Jeffrey W. Hollister
- affilnum: 1
  name: Betty J. Kreakie
affiliation:
- affil: US Environmental Protection Agency, Office of Research and Development, National
    Health and Environmental Effects Research Laboratory, Atlantic Ecology Division,
    27 Tarzwell Drive  Narragansett, RI, 02882, USA
  affilnum: 1
output:
  pdf_document:
    fig_caption: yes
    keep_tex: yes
    number_sections: yes
    template: components/manuscript.latex
  html_document: null
  word_document: null
capsize: normalsize
csl: components/ecology.csl
documentclass: article
fontsize: 11pt
linenumbers: no
bibliography: components/manuscript.bib
spacing: doublespacing
abstract: no
---

<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{Microsystin Chlorophyll Manusript}
-->

```{r setup, include=FALSE, echo=FALSE}
#Put whatever you normally put in a setup chunk.
#I usually at least include:
################################################################################
#Load packages
################################################################################
if(!require(microcystinchla)){
  devtools::install_github("jhollist/microcystinchla",
                           auth_token = getOption("Github_Access"))
}
if(!require(viridis)){
  install.pacakges("viridis") 
}
library("microcystinchla")
library("dplyr")
library("magrittr")
library("pander")
library("knitr")
opts_chunk$set(dev = 'pdf', fig.width=6, fig.height=5)

# Table Captions from @DeanK on http://stackoverflow.com/questions/15258233/
# using-table-caption-on-r-markdown-file-using-knitr-to-use-in-pandoc-to-convert-t
# Figure captions are handled by LaTeX

knit_hooks$set(tab.cap = function(before, options, envir) {
                  if(!before) { 
                    paste('\n\n:', options$tab.cap, sep='') 
                  }
                })
default_output_hook = knit_hooks$get("output")
knit_hooks$set(output = function(x, options) {
  if (is.null(options$tab.cap) == FALSE) {
    x
  } else
    default_output_hook(x,options)
})
```

```{r analysis , include=FALSE, echo=FALSE, cache=TRUE}
#All analysis in here, that way all bits of the paper have access to the final objects
#Place tables and figures and numerical results where they need to go.



################################################################################
# Data Prep
################################################################################
data_url<-"http://water.epa.gov/type/lakes/assessmonitor/lakessurvey/upload/NLA2007_Recreational_ConditionEstimates_20091123.csv"
nla_dat <- get_nla(data_url)
nla_dat <- mutate(nla_dat,log_chla = log10(CHLA),log_micro = log10(MCYST_TL_UGL))

################################################################################
# Condtional Probability
################################################################################
mc_guides <- c(0.3, 1, 1.6, 2, 4, 10, 20)
mc_names <- c("U.S. EPA","WHO","U.S. EPA","WHO","WHO","WHO","WHO")
mc_type <- c("Drinking","Drinking","Drinking","Recreational","Recreational","Recreational","Recreational")
mc_chla <- vector("numeric",length(mc_guides))
#wgt <- nla_dat$WGT_NLA
wgt<- rep(1,nrow(nla_dat))

epa_child_cp <- condprob(xX = nla_dat$log_chla,xY = nla_dat$log_micro, 
                     xImpair = log10(mc_guides[1]), ProbComp = "gt", Exceed = "gte",
                     ci = TRUE, R = 100, xW=wgt)

mc_chla[1] <- get_chla(epa_child_cp,0.5)

who_drink_cp <- condprob(xX = nla_dat$log_chla,xY = nla_dat$log_micro, 
                     xImpair = log10(mc_guides[2]), ProbComp = "gt", Exceed = "gte",
                     ci = TRUE, R = 100, xW=wgt)

mc_chla[2] <- get_chla(who_drink_cp,0.5)

epa_adult_cp <- condprob(xX = nla_dat$log_chla,xY = nla_dat$log_micro, 
                     xImpair = log10(mc_guides[3]), ProbComp = "gt", Exceed = "gte",
                     ci = TRUE, R = 100, xW=wgt)

mc_chla[3] <- get_chla(epa_adult_cp,0.5)

who_rec_low1_cp <- condprob(xX = nla_dat$log_chla,xY = nla_dat$log_micro, 
                     xImpair = log10(mc_guides[4]), ProbComp = "gt", Exceed = "gte",
                     ci = TRUE, R = 100, xW=wgt)

mc_chla[4] <- get_chla(who_rec_low1_cp,0.5)

#who_rec_low2_cp <- condprob(xX = nla_dat$log_chla,xY = nla_dat$log_micro, 
#                     xImpair = log10(mc_guides[5]), ProbComp = "gt", Exceed = "gte",
#                     ci = TRUE, R = 100, xW=wgt)

#mc_chla[5] <- get_chla(who_rec_low2_cp,0.5)

#who_rec_med1_cp <- condprob(xX = nla_dat$log_chla,xY = nla_dat$log_micro, 
#                     xImpair = log10(mc_guides[6]), ProbComp = "gt", Exceed = "gte",
#                     ci = TRUE, R = 100, xW=wgt)

#mc_chla[6] <- get_chla(who_rec_med1_cp,0.5)

#who_rec_med2_cp <- condprob(xX = nla_dat$log_chla,xY = nla_dat$log_micro, 
#                     xImpair = log10(mc_guides[7]), ProbComp = "gt", Exceed = "gte",
#                     ci = TRUE, R = 100, xW=wgt)

#mc_chla[7] <- get_chla(who_rec_med2_cp,0.5)
```


\singlespace

\vspace{2mm}\hrule

<!-- Abstract is being wrapped in latex here so that all analysis can be run in the chunk above and the results reproducibly referenced in the abstract. -->
Cyanobacteria harmful algal blooms (cHABs) are associated with a wide range of adverse health effects that stem mostly from the presence of cyanotoxins.  To help protect against these impacts, several health advisory levels have been set for some toxins.  In particular, one of the more common toxins, microcystin, has several advisory levels set for drinking water and recreational use and managing water bodies to meet those levels could have far reaching benefits.  However, compared to other water quality measures, measurements of microcystin are not common and current field measurement techniques have limited precision and accuracy.  Addressing these issues will take time and resources.  Thus, there is utility in finding indicators of microcystin that are already widely available, can be estimated quickly and *in situ*, and used as a first defense against high levels of microcystin.  In particular, chlorophyll *a* is very commonly measured, can be estimated *in situ*, and has been shown to be positively associated with microcystin.  In this paper we use this association to provide estimates of chlorophyll *a* that if exceeded would be indicative of a higher probability of exceeding select health advisory concentrations for microcystin-LR.  Using the 2007 National Lakes Assessment and a conditional probability approach that has been used in other water quality settings, we identify chlorophyll *a* concentrations that are more likely than not to be associated with an exceedance of a microcystin health advisory level.  We look at the recent US EPA standards for drinking water as well as the World Health Organization levels for drinking water and recreational use.  For microcystin concentrations of 0.3, 1, 1.6, and 2 we find chlorophyll *a* concentrations of `r mc_chla[1]`, `r mc_chla[2]`, `r mc_chla[3]`, and `r mc_chla[4]`, respectively.  When managing for these various microcystin levels exceeding these reported chlorophyll *a* concentrations should be a trigger for further testing and possible management action.   

\vspace{3mm}\hrule
\doublespace

#Introduction

In the summer of 2014, the city of Toledo, OH was forced to shut down their municipal water supply due in part to an excess of microcystin-LR that resulted from a ongoing cyanobacteria harmful algal bloom (cHAB) in Lake Erie [REFS].  Since this event, significant legislation has been passed in the United States and the US Environmental Protection Agency (USEPA) has released suggested microcystin-LR concentrations that would trigger health advisories.  MORE ON THE LEVELS. While these levels and associated advisories are likely to help mitigate the impacts from harmful algal blooms, they are not without complications.  

One of these complications is that they rely on available measurements of microcystin-LR.  This toxin can be measured in the field using test strips but these are a coarse measure at best and currently available test strips focus on 1 and 10 $\mu$g/L [REFS].  Measurements with greater accuracy and precision require taking water samples and processing those in a lab to determine the toxin concentration [REFS].  Additionally, microcystin-LR is, currently, not a routinely collected water quality parameter,thus, availability of microcystin-LR data may limit our ability to screen water bodies for exceedances of the various health advisories concentrations.  Until microcystin-LR concentrations are more widely collected an alternative measure is needed. Fortunately, microcystin-LR has been shown to be associated with several other, more easily measured components of water quality.

Chlorophyll *a* is a very commonly measured components of water quality that is also known to be associated with Microsystin-LR concentrations [REFS].  Additionally there are many rapid measurements for assessing chlorophyll *a* levels *in situ*.  For instance, there are small or hand held flourometers that provide reliable measurements [REFS].   Given these facts, it might be possible to identify chlorophyll *a* concentrations that would be associated with the various Microcystin-LR health advisory levels.  Identifying these associations would provide another reliable tool for water resource managers to use to help manage the threat to public health posed by cHABs and would be especially useful in the absence of microcystin-LR concentrations.  Thus, the goal of this paper is to utlize the National Lakes Assessment data and identify chlorophyll *a* concentrations that are associated with higher probabilities of exceeding several microcystin-LR health advisory concentrations [NLA REF].  So that others may repeat or adjust this analysis, the data, code, and this manuscript are freely available via [https://github.com/USAPE/microcystinchla](https://github.com/USAPE/microcystinchla).

#Methods

##Data
We used the 2007 National Lakes Assessment (NLA) water quality and microcystin-LR concentration data [REF]. These data represent a snapshot of water quality from the summer of 2007 and data on chlorophyll *a* and microcystin-LR concentrations are available for `r nrow(na.omit(nla_dat$CHLA,nla_dat$MCYST_TL_UGL))` lakes.  

##Conditional Probability Analysis
We used a conditional probability analysis (CPA) approach to explore associations between chlorophyll *a* concentrations  and World Health Organization (WHO) and U.S. Environmental Protection Agency (U.S. EPA) microcystin-LR health advisory levels [@paul2011probability].  Many levels have been suggested (Table \ref{tab:microcystin_levels}), but lakes with higher microcystin-LR concentrations in the NLA were rare. Only `r round(100*(length(nla_dat$MCYST_TL_UGL[nla_dat$MCYST_TL_UGL>=10])/nrow(nla_dat)),2)` % of lakes sampled had a concentration greater than 10.  Thus, for this analysis we focus on the microcystin concentrations that are better represented in the NLA data. These were  0.3, 1, 1.6, and 2 $\mu$g/L.

A detailed discussion of CPA is beyond the scope of this paper, but see Paul et al. [-REF] and Hollister et al. [-REF] for details.  For this analysis, we used CPA to examine how the conditional probability of exceeding one of the health advisory changes as chlorophyll *a* increases in a lake.  The 95% confidence intervals were calculated from 1000 bootstrapped samples. To identify chlorophyll *a* concentrations of concern we used a 50% conditional probability of exceeding each health advisory level and extracted the minimum chlorophyll *a* concentration that was associated with the upper confidence level being 50% or greater.  As both microcystin-LR and chlorophyll *a* values were both highely skewed right, a log base 10 transformation was used.  Additional details of the specific implementation are available at https://github.com/USEPA/microcystinchla.

#Results

In the 2007 NLA, microcystin-LR concentrations ranged from `r min(nla_dat$MCYST_TL_UGL,na.rm=T)` to `r max(nla_dat$MCYST_TL_UGL, na.rm=T)`.  Microcystin-LR concentrations of 0.05 $\mu$g/L represent the detection limits.  Any value greater than that indicates the presence of microcystin-LR.  Of those lakes with microcystin, the median concentration was `r median(nla_dat$MCYST_TL_UGL[nla_dat$MCYST_TL_UGL>0.05],na.rm=T)` and the mean was `r median(nla_dat$MCYST_TL_UGL[nla_dat$MCYST_TL_UGL>0.05],na.rm=T)`.  Lastly, of all lakes sampled, `r round(100*(length(nla_dat$MCYST_TL_UGL[nla_dat$MCYST_TL_UGL>=0.3])/length(nla_dat$MCYST_TL_UGL)),1)`% of lakes exceeded the U.S. EPA childrens drinking water standard, `r round(100*(length(nla_dat$MCYST_TL_UGL[nla_dat$MCYST_TL_UGL>=1.6])/length(nla_dat$MCYST_TL_UGL)),1)`% of lakes exceeded the U.S. EPA adult drinking water standard,`r round(100*(length(nla_dat$MCYST_TL_UGL[nla_dat$MCYST_TL_UGL>=1])/length(nla_dat$MCYST_TL_UGL)),1)`% of lakes exceeded the WHO drinking water standard,and `r round(100*(length(nla_dat$MCYST_TL_UGL[nla_dat$MCYST_TL_UGL>=2])/length(nla_dat$MCYST_TL_UGL)),1)`% of lakes exceeded the WHO recreational standard. For chlorophyll *a*, the range was `r min(nla_dat$CHLA,na.rm=T)` to `r max(nla_dat$CHLA, na.rm=T)`.  All lakes had reported chlorophyll *a* concentrations that exceeded detection limits.  The median concentration was `r median(nla_dat$CHLA,na.rm=T)` and the mean was `r mean(nla_dat$CHLA,na.rm=T)`.

The association between Log 10 microcystin-LR and Log 10 chlorophyll *a* show a wedge pattern (Figure \ref{fig:chla_micro_scatter}).  This indicates that higher concentrations of microcystin-LR almost always co-occur with higher concentrations of chlorophyll *a* yet the inverse is not true.  Higher chlorophyll *a* is not necessarily predictive of higher microcystin-LR concentrations; however, chlorophyll *a* may be predictive of the probability of exceeding a certian concentration.  This is the case as the probability of exceeding each of the four tested health adviroy levels shos this patern of probability of exceeding the advisory level increases as a function of chlorophyll *a* concentration (Figure \ref{fig:multi_cp_plot}).

We use this association to identify chlorophyll *a* concentrations that are associated with greater than even odds of exceeding a given health advisory level (Table \ref{tab:mc_chla_table}).  These represent `r round(100*(length(nla_dat$CHLA[nla_dat$CHLA>=mc_chla[1]])/length(nla_dat$CHLA)),1)`%, `r round(100*(length(nla_dat$CHLA[nla_dat$CHLA>=mc_chla[2]])/length(nla_dat$CHLA)),1)`%,
`r round(100*(length(nla_dat$CHLA[nla_dat$CHLA>=mc_chla[3]])/length(nla_dat$CHLA)),1)`%, and `r round(100*(length(nla_dat$CHLA[nla_dat$CHLA>=mc_chla[4]])/length(nla_dat$CHLA)),1)`% of sample lakes for the U.S EPA childrens drinking water, the WHO drinking water, the U.S. EPA Adult drinking water, and the WHO recreationsl standards, respecitvely.
<!-- (Figure \ref{fig:chla_micro_cdf}) -->

#Discussion

#Figures

```{r chla_micro_scatter, echo=FALSE, fig.width=8, fig.cap="Scatterplot showing association betweeen chlorophyll \\textit{a} and microcystin-LR. \\label{fig:chla_micro_scatter}"}
plot_scatter(nla_dat,xvar="log_chla",yvar = "log_micro",pt_col=viridis(1),
             x=expression(paste('Log10 Chl ', italic("a"),' (',mu,'g/L)')),
             y=expression(paste('Log10 microcystin-LR',' (',mu,'g/L)')))
```

\newpage

<!--
```{r chla_micro_cdf, echo=FALSE, fig.width=8, fig.cap="Conditional probability plots showing association between the probability of exceeding various microcystin-LR (MLR) health advisory Levels. \\label{fig:chla_micro_cdf}"}
plot_cdf(nla_dat[,c("log_chla","log_micro")],"")
```

\newpage-->

```{r epa_child_cp_plot, echo=FALSE, fig.width=8, fig.cap="Conditional probability plots showing association between the probability of exceeding various microcystin-LR (MLR) health advisory Levels. \\label{fig:multi_cp_plot}"}
multiplot(
  plot_cp(epa_child_cp,x = "Log 10 Chlorophyll", 
          y = "Probability of Exceeding 0.3 ug/L MLR",
          title="U.S. EPA Children's Drinking Water Advisory Level"),
  plot_cp(who_drink_cp, x = "Log 10 Chlorophyll", 
          y = "Probability of Exceeding 1 ug/L MLR", 
          title="WHO Drinking Water Advisory Level"),
  plot_cp(epa_adult_cp, x = "Log 10 Chlorophyll", 
          y = "Probability of Exceeding 1.6 ug/L MLR", 
          title="U.S. EPA Adult Drinking Water Advisory Level"),
  plot_cp(who_rec_low1_cp, x = "Log 10 Chlorophyll", 
          y = "Probability of Exceeding 2 ug/L MLR", 
          title="WHO Recreational Water Advisory Level"),
  cols=2
)
```

\newpage

#Tables

```{r microcystin_levels,echo=FALSE,results='asis', tab.cap="Various suggested microcystin-LR health advisory concentrations. \\label{tab:microcystin_levels}"}
source_of_stnd <- c("WHO",
                    "WHO",
                    "WHO",
                    "WHO",
                    "WHO",
                    "U.S. EPA",
                    "U.S. EPA")
type_of_stnd <- c("Recreational",
                  "Recreational",
                  "Recreational",
                  "Recreational",
                  "Drinking",
                  "Drinking",
                  "Drinking")
concentration <- c("2-4 $\\mu$g/L",
                   "10-20 $\\mu$g/L",
                   "20-2000 $\\mu$g/L",
                   ">2000 $\\mu$g/L",
                   "1 $\\mu$g/L",
                   "0.3 $\\mu$g/L",
                   "1.6 $\\mu$g/L")
#note <- c("Low probability of adverse health effects",
#          "Moderate probability of adverse health effects",
#          "High probability of adverse health effects, These higher #concentrations typically only seen in visible scums/algal mats",
#          "Very high probability of adverse health effects",
#          "",
#          "Children younger than school age",
#          "Individuals School age and older")
mc_conc_table <- data.frame(source_of_stnd, type_of_stnd, concentration) %>%
  arrange(type_of_stnd)
names(mc_conc_table)<-c("Source","Type","Concentration")
pandoc.table(mc_conc_table,justify = "left" ,split.table = 120, split.cells  = c(20,20,20))
```

\newpage

```{r mc_chla_table, results='asis', echo=FALSE, tab.cap="Chlorophyll \textit{a} concentrations that are associated with a 50% probability of exceeding a microcystin-LR health advisory concentration. \\label{tab:mc_chla_table}"}
mc_chla_tbl <- data.frame(Source=mc_names,Type=mc_type,Microcystin=mc_guides,Chlorophyll=mc_chla)[1:4,]
pandoc.table(mc_chla_tbl,justify = "left" ,split.table = 120, split.cells  = c(20,20,20))
```

#References